<?php	//用户信息控制器	class UserSettingAction extends Action{		//用户基本信息视图		public function index(){			$where = array('uid' => session('uid'));			$field = array('username', 'truename', 'sex', 'location', 'constellation', 'intro', 'face180');			$user=M('userinfo')->field($field)->where($where)->find();			$this->user=$user;			//p($user);die;			$this->display();		}		//修改用户基本信息		public function editBasic(){			$data=array(				'username'=>$this->_post('username'),				'truename'=>$this->_post('truename'),				'sex'=>$this->_post('sex'),				'location'=>$this->_post('location'),				'constellation'=>$this->_post('constellation'),				'intro'=>$this->_post('intro'),			);						$sex=$_POST['sex'];			if($data['sex'] == 0){				$style=array(					'style'=>'style2'				);				M('userinfo')->where(array('uid'=>session('uid')))->save($style);			}						$where=array('uid'=>session('uid'));						$db=M('userinfo');			if($db->where($where)->data($data)->save()){				$this->success('修改成功 ^_^',U('index'));			}else{				$this->error('修改失败 ~_~!');			}		}				//修改用户头像		public function editFace(){			if(!$this->isPost()){				halt('页面不存在');			}			$db=M('userinfo');			$where=array('uid'=>session('uid'));			$filed=array('face50','face80','face180');			$old=$db->where($where)->field($field)->find();			if($db->where($where)->save($_POST)){				if(!empty($old['face180'])){					@unlink('./Uploads/Face/'.$old['face180']);					@unlink('./Uploads/Face/'.$old['face80']);					@unlink('./Uploads/Face/'.$old['face50']);				}				$this->success('修改成功',U('index'));			}else{				$this->error('修改失败，请重试。。。');			}		}		//修改密码		public function editPwd(){			if(!$this->isPost()){				halt('页面不存在');			}			$db=M('user');			$where=array('id'=>session('uid'));			$old=$db->where($where)->getField('password');			if($this->_post('oldPassword','md5')!=$old){				$this->error('旧密码错误');			}						if($this->_post('newPassword')!=$this->_post('rePassword')){				$this->error('两次密码不一致');			}						$newPwd=$this->_post('newPassword','md5');			$data=array(				'id'=>session('uid'),				'password'=>$newPwd			);			if($db->save($data)){				$this->success('修改成功',U('index'));			}else{				$this->error('修改失败,请重试');			}		}	}?>